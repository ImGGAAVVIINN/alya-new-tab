<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Dropdown Menu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .custom-dropdown {
      position: relative;
      display: inline-block;
      width: 100%;
      max-width: 400px;
    }
    .dropdown-button {
      width: 100%;
      padding: 10px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: left;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      width: 100%;
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      padding: 0;
      box-sizing: border-box;
      max-height: 300px;
      overflow-y: auto;
      transition: opacity 0.3s ease;
    }
    .custom-dropdown:hover .dropdown-content {
      display: block;
      opacity: 1;
    }
    .dropdown-content div {
      padding: 8px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      height: 30px; /* Set a fixed height for items */
    }
    .dropdown-content div img {
      width: 16px;
      height: 16px;
      margin-right: 10px;
      opacity: 0.6; /* Make icons transparent */
    }
    .dropdown-content div button {
      background-color: transparent; /* Make buttons transparent */
      border: none;
      opacity: 0.6; /* Make buttons transparent */
      font-size: 12px;
      cursor: pointer;
    }
    .dropdown-content div button:hover {
      opacity: 1; /* Full opacity on hover */
    }
    .dropdown-content div span {
      color: #000; /* Ensure text is fully visible */
    }
    .dropdown-content div:hover {
      background-color: #ddd;
    }
    .input-group {
      margin-bottom: 10px;
    }
    .input-group input {
      width: calc(100% - 110px);
      padding: 10px;
      margin-right: 10px;
      box-sizing: border-box;
    }
    .input-group button {
      width: 100px;
      padding: 10px;
    }
  </style>
</head>
<body>

  <h1>Add URLs to Custom Dropdown Menu</h1>

  <div class="custom-dropdown">
    <div class="dropdown-button">Select a site</div>
    <div id="siteList" class="dropdown-content">
      <div class="input-group">
        <input type="url" id="siteUrl" placeholder="Enter site URL" required>
        <button onclick="addSite()">Add Site</button>
      </div>
      <!-- Existing sites will be appended here -->
    </div>
  </div>

  <script>
    function extractSiteName(url) {
      let siteName = url.replace(/^https?:\/\/(www\.)?/, '');
      siteName = siteName.replace(/\.(com|net|org|edu|gov|io|co|biz|info)$/, '');
      siteName = siteName.charAt(0).toUpperCase() + siteName.slice(1);
      return siteName;
    }

    function fetchSiteInfo(url, callback) {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`, true); // true for asynchronous
      xhr.onload = function() {
        if (xhr.status === 200) {
          const parser = new DOMParser();
          const doc = parser.parseFromString(xhr.responseText, 'text/html');
          const siteName = doc.querySelector('title')?.innerText.trim() || extractSiteName(url);
          const icon = `https://s2.googleusercontent.com/s2/favicons?domain_url=${encodeURIComponent(url)}`;
          callback({ siteName, icon });
        } else {
          console.error('Error fetching site info:', xhr.statusText);
          callback({ siteName: extractSiteName(url), icon: 'https://via.placeholder.com/16' });
        }
      };
      xhr.onerror = function() {
        console.error('Request error');
        callback({ siteName: extractSiteName(url), icon: 'https://via.placeholder.com/16' });
      };
      xhr.send();
    }

    function addSite() {
      const url = document.getElementById('siteUrl').value;
      if (!url) {
        alert('Please enter a valid URL.');
        return;
      }

      fetchSiteInfo(url, function(siteInfo) {
        const { siteName, icon } = siteInfo;
        const siteList = document.getElementById('siteList');

        const option = document.createElement('div');
        option.className = 'dropdown-item';
        option.innerHTML = `
          <img src="${icon}" alt="${siteName}">
          <span>${siteName}</span>
          <div class="action-buttons">
            <button onclick="moveUp(this)">▲</button>
            <button onclick="moveDown(this)">▼</button>
            <button onclick="removeSite(this)">✖</button>
          </div>
        `;
        option.dataset.url = url; // Store URL for removal and moving
        siteList.appendChild(option);
        
        saveToLocalStorage(url, siteName, icon);
        document.getElementById('siteUrl').value = '';
      });
    }

    function saveToLocalStorage(url, siteName, icon) {
      let sites = JSON.parse(localStorage.getItem('sites')) || [];
      sites.push({ url, siteName, icon });
      localStorage.setItem('sites', JSON.stringify(sites));
    }

    function loadFromLocalStorage() {
      let sites = JSON.parse(localStorage.getItem('sites')) || [];
      sites.forEach(site => {
        const { url, siteName, icon } = site;
        const option = document.createElement('div');
        option.className = 'dropdown-item';
        option.innerHTML = `
          <img src="${icon}" alt="${siteName}">
          <span>${siteName}</span>
          <div class="action-buttons">
            <button onclick="moveUp(this)">▲</button>
            <button onclick="moveDown(this)">▼</button>
            <button onclick="removeSite(this)">✖</button>
          </div>
        `;
        option.dataset.url = url;
        document.getElementById('siteList').appendChild(option);
      });
    }

    function moveUp(button) {
      const item = button.parentElement.parentElement;
      const previous = item.previousElementSibling;
      if (previous && previous.classList.contains('dropdown-item')) {
        item.parentElement.insertBefore(item, previous);
        updateLocalStorage();
      }
    }

    function moveDown(button) {
      const item = button.parentElement.parentElement;
      const next = item.nextElementSibling;
      if (next && next.classList.contains('dropdown-item')) {
        item.parentElement.insertBefore(next, item);
        updateLocalStorage();
      }
    }

    function removeSite(button) {
      const item = button.parentElement.parentElement;
      item.remove();
      updateLocalStorage();
    }

    function updateLocalStorage() {
      const items = document.querySelectorAll('.dropdown-item');
      let sites = [];
      items.forEach(item => {
        const url = item.dataset.url;
        const siteName = item.querySelector('span').innerText;
        const icon = item.querySelector('img').src;
        sites.push({ url, siteName, icon });
      });
      localStorage.setItem('sites', JSON.stringify(sites));
    }

    window.onload = loadFromLocalStorage;
  </script>

</body>
</html>
